# RecRadiko 要件定義書

## 1. 認証・アクセス制御

### 1.1 機能要件
- **FR-A001**: システムはユーザーのIPアドレスから地理的位置を判定し、Radikoサービスエリア内であることを確認する
- **FR-A002**: システムはRadikoの認証APIを使用して有効な認証トークンを取得する
- **FR-A003**: システムはプレミアム会員のログイン情報を保存し、プレミアム限定コンテンツへのアクセスを可能にする
- **FR-A004**: 認証トークンは適切な期間キャッシュし、期限切れ時は自動的に再取得する

### 1.2 非機能要件
- **NFR-A001**: 認証処理は30秒以内に完了する
- **NFR-A002**: 認証情報は暗号化して保存する
- **NFR-A003**: 認証エラー時は適切なエラーメッセージを表示する

## 2. 番組情報取得

### 2.1 機能要件
- **FR-P001**: システムは指定された日付・時間範囲の番組表を取得する
- **FR-P002**: システムは全放送局のリストを取得・更新する
- **FR-P003**: システムは番組の詳細情報（タイトル、出演者、番組説明、ジャンル）を取得する
- **FR-P004**: システムは番組情報をローカルデータベースにキャッシュする

### 2.2 非機能要件
- **NFR-P001**: 番組情報取得は10秒以内に完了する
- **NFR-P002**: 番組情報は24時間キャッシュする
- **NFR-P003**: APIレート制限に準拠する（1分間に60リクエスト以下）

## 3. ストリーミング処理

### 3.1 機能要件
- **FR-S001**: システムはHLS（HTTP Live Streaming）URLを取得する
- **FR-S002**: システムはM3U8プレイリストを解析し、TSセグメントURLを抽出する
- **FR-S003**: システムはTSセグメントファイルを順次ダウンロードする
- **FR-S004**: 暗号化されたストリームの場合、復号化処理を実行する
- **FR-S005**: システムはリアルタイムストリーミングとタイムシフト再生の両方をサポートする

### 3.2 非機能要件
- **NFR-S001**: ストリーミング開始は5秒以内に完了する
- **NFR-S002**: ネットワーク帯域幅の90%以上を有効利用する
- **NFR-S003**: 接続断時は自動的に再接続を試行する（最大5回）

## 4. 録音・録画処理

### 4.1 機能要件
- **FR-R001**: システムは指定された時間範囲で音声ストリームを録音する
- **FR-R002**: システムは複数の音声形式（AAC、MP3、WAV）で保存する
- **FR-R003**: システムは録音中の一時停止・再開機能を提供する
- **FR-R004**: システムは録音品質（ビットレート）を設定可能にする
- **FR-R005**: システムは同時に複数の放送局を録音可能にする

### 4.2 非機能要件
- **NFR-R001**: 録音データの音質劣化は最小限に抑える
- **NFR-R002**: 録音ファイルサイズは元ストリームの105%以下とする
- **NFR-R003**: 同時録音数は最大8局とする

## 5. ファイル管理

### 5.1 機能要件
- **FR-F001**: システムは録音ファイルを「放送局名_番組名_日時.拡張子」の形式で命名する
- **FR-F002**: システムはファイルにメタデータ（タイトル、アーティスト、日時）を埋め込む
- **FR-F003**: システムは録音ファイルを日付・放送局別にディレクトリ分けする
- **FR-F004**: システムは古いファイルの自動削除機能を提供する
- **FR-F005**: システムはディスク容量を監視し、不足時に警告する

### 5.2 非機能要件
- **NFR-F001**: ファイル操作は安全性を確保する（原子性操作）
- **NFR-F002**: ファイル名は全角文字を適切に処理する
- **NFR-F003**: 最低10GB以上の空き容量が必要

## 6. スケジューリング

### 6.1 機能要件
- **FR-SC001**: システムは番組の予約録音を設定する
- **FR-SC002**: システムは定期録音（毎日、毎週）を設定する
- **FR-SC003**: システムは録音スケジュールの競合を検出・通知する
- **FR-SC004**: システムは録音開始・終了時刻の5分前に通知する
- **FR-SC005**: システムは録音スケジュールをファイルに保存・復元する

### 6.2 非機能要件
- **NFR-SC001**: スケジューリング精度は±5秒以内とする
- **NFR-SC002**: 最大1000件の録音予約を管理する
- **NFR-SC003**: システム再起動後もスケジュールを維持する

## 7. エラーハンドリング

### 7.1 機能要件
- **FR-E001**: システムはネットワークエラー時に自動再試行する
- **FR-E002**: システムは認証エラー時に再認証を試行する
- **FR-E003**: システムはストリーム中断時に再接続を試行する
- **FR-E004**: システムは全てのエラーをログファイルに記録する
- **FR-E005**: システムは致命的エラー時にユーザーに通知する

### 7.2 非機能要件
- **NFR-E001**: エラー発生時の復旧時間は30秒以内とする
- **NFR-E002**: ログファイルは最大100MBで自動ローテーションする
- **NFR-E003**: エラーメッセージは日本語で表示する

## 8. 全体的な制約事項

### 8.1 技術的制約
- Python 3.8以上で動作する
- 外部ライブラリの使用は最小限に抑える
- マルチプラットフォーム対応（Windows、macOS、Linux）

### 8.2 法的制約
- 著作権法に準拠し、個人使用の範囲内で使用する
- Radikoの利用規約を遵守する
- 商用利用は禁止する

### 8.3 運用制約
- 24時間連続動作に対応する
- メモリ使用量は1GB以下に抑える
- CPU使用率は平均30%以下に抑える